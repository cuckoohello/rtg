<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>肾糖阈估算</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <link rel="stylesheet" href="//res.wx.qq.com/open/libs/weui/1.1.1/weui.min.css"/>
    <script rel="script" src="//res.wx.qq.com/open/libs/weuijs/1.0.0/weui.min.js"></script>
    <script src="//cdn.bootcss.com/fetch/2.0.2/fetch.min.js"></script>
</head>
<body ontouchstart>
<div class="container">
    <div class="page">
        <div class="page__hd" style="text-align: center">
            <h1 class="page__title">肾糖阈估算<a href="en.html" style="margin-left: 20px" class="weui-btn weui-btn_mini weui-btn_default">English</a></h1>
            <p class="page__desc">请输入身高、体重、0-240min的尿液葡萄糖排出量(UGE)、估算的肾小球滤过率(eGFR)及对应时间点的血糖浓度，点击"计算"</p>
        </div>
        <div class="page__bd page__bd_spacing">
            <div id="form">
                <div class="weui-cells weui-cells_form">
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">身高(cm)</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="height" required placeholder="身高" emptyTips="请输入身高(厘米)">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">体重(kg)</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="weight" required placeholder="体重" emptyTips="请输入体重(公斤)">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">UGE(mmol)</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="uge" required placeholder="UGE" emptyTips="请输入UGE">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">eGFR(mL/min/1.73m^2)</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="egfr" required placeholder="eGFR" emptyTips="请输入eGFR">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd">
                            <label class="weui-label">时间</label>
                        </div>
                        <div class="weui-cell__bd">
                            <label class="weui-input">血糖浓度(mmol/L)</label>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">0 min</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="blood0" required placeholder="0min血糖浓度" emptyTips="请输入0min血糖浓度">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">30 min</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="blood30" required placeholder="30min血糖浓度" emptyTips="请输入30min血糖浓度">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">60 min</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="blood60" required placeholder="60min血糖浓度" emptyTips="请输入60min血糖浓度">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">90 min</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="blood90" required placeholder="90min血糖浓度" emptyTips="请输入90min血糖浓度">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">120 min</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="blood120" required placeholder="120min血糖浓度" emptyTips="请输入120min血糖浓度">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">180 min</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="blood180" required placeholder="180min血糖浓度" emptyTips="请输入180min血糖浓度">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd"><label class="weui-label">240 min</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" type="number" id="blood240" required placeholder="240min血糖浓度" emptyTips="请输入240min血糖浓度">
                        </div>
                        <div class="weui-cell__ft">
                            <i class="weui-icon-warn"></i>
                        </div>
                    </div>
                </div>
                <div class="weui-btn-area">
                    <a id="formSubmitBtn" href="javascript:" class="weui-btn weui-btn_primary">计算</a>
                </div>
            </div>
        </div>
        <div class="page__ft" style="text-align: center">
            <h2 id="result" class="page__desc"></h2>
        </div>
    </div>
</div>
<script rel="script">
    weui.form.checkIfBlur('#form');

    document.querySelector('#formSubmitBtn').addEventListener('click', function () {
        weui.form.validate('#form', function (error) {
            console.log(error);
            if (!error) {
                var loading = weui.loading('提交中...');
                var uge = parseFloat(document.getElementById('uge').value);
                var egfr = parseFloat(document.getElementById('egfr').value);
                var height = parseFloat(document.getElementById('height').value);
                var weight = parseFloat(document.getElementById('weight').value);
                var blood = [];
                blood.push(parseFloat(document.getElementById('blood0').value));
                blood.push(parseFloat(document.getElementById('blood30').value));
                blood.push(parseFloat(document.getElementById('blood60').value));
                blood.push(parseFloat(document.getElementById('blood90').value));
                blood.push(parseFloat(document.getElementById('blood120').value));
                blood.push(parseFloat(document.getElementById('blood180').value));
                blood.push(parseFloat(document.getElementById('blood240').value));
                fetch('/rtg', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        height: height,
                        weight: weight,
                        gfr: egfr,
                        uge: uge,
                        x: [0.0,30.0,60.0,90.0,120.0,180.0,240.0],
                        y: blood
                    })
                }).then(function (response) {
                    return response.json();
                }).then(function (json) {
                    if (json.length != 1) {
                        document.getElementById('result').innerHTML="计算出错!";
                    } else {
                        document.getElementById('result').innerHTML="肾糖阈估算值:"+new Number(json[0]).toFixed(2)+"mmol/L";
                    }
                    window.scrollTo(0,document.body.scrollHeight);
                    loading.hide();
                });
            }
        });
    });
</script>
</body>
</html>
